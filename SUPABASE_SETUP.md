# Настройка Supabase для сохранения лидов

Это руководство поможет вам настроить Supabase для хранения данных из форм.

## Шаг 1: Создание проекта в Supabase

1. Перейдите на [https://app.supabase.com](https://app.supabase.com)
2. Войдите или создайте новый аккаунт
3. Нажмите "New Project"
4. Заполните информацию о проекте:
   - **Name**: выберите имя для проекта (например, "restailing")
   - **Database Password**: создайте надежный пароль (сохраните его!)
   - **Region**: выберите ближайший регион
5. Нажмите "Create new project"
6. Подождите несколько минут, пока проект создается

## Шаг 2: Создание таблиц в базе данных

1. После создания проекта откройте вкладку **SQL Editor** в боковом меню
2. Нажмите "New query"
3. Скопируйте и вставьте весь код из файла `supabase-setup.sql`
4. Нажмите "Run" или нажмите `Ctrl+Enter` / `Cmd+Enter`
5. Вы должны увидеть сообщение "Success. No rows returned"

Это создаст две таблицы:
- `leads` - для полной формы (с адресом, бюджетом и т.д.)
- `simple_leads` - для упрощенной формы (только имя, email, телефон, сервис)

## Шаг 3: Получение API ключей

1. Откройте вкладку **Settings** (шестеренка) в боковом меню
2. Выберите **API** в левом меню
3. Найдите раздел **Project API keys**
4. Скопируйте следующие значения:
   - **Project URL** (что-то вроде `https://xxxxx.supabase.co`)
   - **anon public** ключ (длинная строка)

## Шаг 4: Настройка переменных окружения

1. Откройте файл `.env.local` в корне проекта
2. Замените заполнители на реальные значения:

```env
NEXT_PUBLIC_SUPABASE_URL=https://ваш-проект.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=ваш-анон-ключ-здесь
```

3. Сохраните файл

⚠️ **Важно**: Файл `.env.local` уже добавлен в `.gitignore`, поэтому он не будет загружен в Git.

## Шаг 5: Перезапуск приложения

1. Остановите dev сервер (если он запущен) - нажмите `Ctrl+C` в терминале
2. Запустите снова:

```bash
npm run dev
```

## Проверка работы

1. Откройте ваше приложение в браузере
2. Заполните любую форму на сайте
3. Перейдите в Supabase → **Table Editor** → выберите таблицу `leads` или `simple_leads`
4. Вы должны увидеть новую запись с данными формы

## Просмотр лидов

- В приложении: откройте `/admin/leads` для просмотра всех лидов
- В Supabase: используйте **Table Editor** для просмотра и управления данными

## Безопасность (важно для продакшена!)

⚠️ **Текущие настройки безопасности предназначены для разработки**

В текущей конфигурации любой может:
- Читать все лиды
- Удалять лиды

Для продакшена рекомендуется:

1. Настроить аутентификацию для админ-панели
2. Обновить RLS (Row Level Security) политики в Supabase:
   - Разрешить публичную вставку (INSERT) - для форм
   - Требовать аутентификацию для чтения (SELECT) - только для админов
   - Требовать аутентификацию для удаления (DELETE) - только для админов

## Дополнительные возможности

### Уведомления по email

Вы можете настроить отправку email уведомлений при новых лидах:
1. Используйте Database Webhooks в Supabase
2. Или интегрируйте с сервисом email (например, SendGrid, Resend)

### Экспорт данных

В админ-панели есть кнопка "Export to CSV" для экспорта всех лидов.

## Поддержка

Если возникли проблемы:
1. Проверьте консоль браузера на ошибки (F12)
2. Проверьте логи в терминале
3. Убедитесь, что переменные окружения правильно настроены
4. Проверьте, что таблицы созданы в Supabase
